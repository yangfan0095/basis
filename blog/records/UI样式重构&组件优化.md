
### CRM-PC UI样式 重构计划
#### 当前CRM-PC  UI样式问题概述




组件样式树如下

```
graph TD

A(全局样式定义)-->B(布局组件全局样式定义)
B-->C(路由级别组件 约70个 )
C-->D(全局公共组件 共78个 )
C-->E(全局业务组件1)
C-->F(组件2)
C-->G(组件3)
C-->H(组件...)
```

#### 目前crm-pc 存在的样式问题：

* 1 **全局样式文件和布局样式文件互相影响** 全局定义文件层次不明， 首先有全局配置文件common.css和布局组件重复定义， 由于important属性最高优先级 存在相互影响。

* **路由级组件子组件继承影响** 当前所有的路由级组件没有加作用域，表现为横向路由级组件之间不会互相影响，但是路由级组件下的子组件（公共组件）会受到 路由级组件的属性受到影响。（举例：如 我在合同详情下 修改了某个el-input ，那么 这个详情下的 新建合同 和编辑合同弹框下的el-input 就会受到影响） 再加上 全局的定义 造成debugger非常困难。

* **公共组件间的交叉影响**， 由于我们使用webpack打包最终的结果是将所有的文件全部打成app.css ，所以组件之间没有加作用域 容易造成对其他组件的**交叉影响** 


 综上三点 尤其是第二点和第三点，造成了我们整个CRM-PC 项目的样式 

* **一是难改** 改动每个组件影响范围大，而且很多时候影响是隐性的
* **二是改了问题容易复现且定位问题原因极为困难**


#### 针对上述问题，现提出如下解决方案
* 解决全局样式相互影响问题 ， 全局样式统一放在common.css 下，如果涉及覆盖element ui ，新建一个element.css 用于根据CRM UI规范全局覆盖我们需要改到的样式

* 针对路由级组件子组件继承影响 和 公共组件交叉影响的问题  **将整个项目css影响作用域 控制在组件内部，所有组件全局加scope标签**   即 一个.vue 组件内部样式只能影响其本身， 如果有需要覆盖公共组件，但并非全局性质，则 以当前组件路径为命名空间 在当前class下 覆盖公共组件（主要指 element ui）

* 此外优化项 引入全局scss变量 根据CRM-UI规范 将base变量放入公共变量文件中，基类元素 如背景 颜色 字体大小，方便后期统一修改。新需求建议这样搞 老需求渐进式优化


#### 具体执行
由于现在开发任务较紧 但是此问题又不得不解决，
主要是隔离作用域这一个点优化比较费时间优化时需要顾及影响。目前大概70个路由及78个公共组件， 进行渐进式的优化 总共费时预计需要花一周时间，由于没有排期所以，我们采用平行于当前开发分支，优化好了，在每一个版本上线后，拉新分支进行合并，并通知UI检验 并在下一个版本发布

* 第一步 先修复高频问题点 (包括解决全局样式相互影响问题)  计划将 销售管理下的 客户、商机、联系人、线索、合同、产品、保险绩效先做上述优化。

* 第二步 根据项目时间安排优化其他项。




#### 高频组件重构 crm-datasource 组件设计图
```
graph TB

A(crm-inputtags) -->  B(crm-tabselect)
B--updateValue-->A

```


### crm-tabselect 

```
graph TB

A(crm-inputtags) -->  B(crm-tabselect)
B--updateValue-->A
B-->C(crmSelectbytree)
B-->F(crmSearchselect)
F--valueChangeCallback-->B
C--valueChangecallback-->B
C-->D(crm-select)
C-->E(crm-usericon)


```
`crm-tabselect`可看做是一个独立的组件 支持选部门和搜索
